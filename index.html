<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">

    <script type="application/javascript" src="seaBattle.js"></script>
    <script src="jquery-ui/js/jquery-1.10.2.js" type="text/javascript"></script>
    <script type="text/javascript" src="lib.js"></script>
    <script type="text/javascript" src="Drag.js"></script>
    <link type="text/css" href="jquery-ui/css/ui-lightness/jquery-ui-1.10.4.css" rel="Stylesheet"/>
    <link rel="stylesheet" type="text/css" href="css.css">
    <title></title>
</head>
<body>

<div id="topic">
    <h1> Морской бой </h1>

    <p>пре-альфа</p>

    <p><a href="https://github.com/Vit220/SeaBattle">ссылка на github</a></p>
</div>

<div class="shipsDiv">
    <div class="shipsRemove_9 shipsRemoveAll" draggable>
    </div>

    <div class="shipsRemove_8 shipsRemoveAll" draggable>
    </div>


    <div class="shipsRemove_0 shipsRemoveAll" draggable>

    </div>
</div>

<div id="playerOne" oncontextmenu="return false;">
    <table class="PlayerField">
        <tr>
            <td class="notToSelect"></td>
            <td class="notToSelect">1</td>
            <td class="notToSelect">2</td>
            <td class="notToSelect">3</td>
            <td class="notToSelect">4</td>
            <td class="notToSelect">5</td>
            <td class="notToSelect">6</td>
            <td class="notToSelect">7</td>
            <td class="notToSelect">8</td>
            <td class="notToSelect">9</td>
            <td class="notToSelect">10</td>
        </tr>
        <tr>
            <td class="notToSelect">1</td>
            <td class="1_1"></td>
            <td class="1_2"></td>
            <td class="1_3"></td>
            <td class="1_4"></td>
            <td class="1_5"></td>
            <td class="1_6"></td>
            <td class="1_7"></td>
            <td class="1_8"></td>
            <td class="1_9"></td>
            <td class="1_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">2</td>
            <td class="2_1"></td>
            <td class="2_2"></td>
            <td class="2_3"></td>
            <td class="2_4"></td>
            <td class="2_5"></td>
            <td class="2_6"></td>
            <td class="2_7"></td>
            <td class="2_8"></td>
            <td class="2_9"></td>
            <td class="2_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">3</td>
            <td class="3_1"></td>
            <td class="3_2"></td>
            <td class="3_3"></td>
            <td class="3_4"></td>
            <td class="3_5"></td>
            <td class="3_6"></td>
            <td class="3_7"></td>
            <td class="3_8"></td>
            <td class="3_9"></td>
            <td class="3_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">4</td>
            <td class="4_1"></td>
            <td class="4_2"></td>
            <td class="4_3"></td>
            <td class="4_4"></td>
            <td class="4_5"></td>
            <td class="4_6"></td>
            <td class="4_7"></td>
            <td class="4_8"></td>
            <td class="4_9"></td>
            <td class="4_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">5</td>
            <td class="5_1"></td>
            <td class="5_2"></td>
            <td class="5_3"></td>
            <td class="5_4"></td>
            <td class="5_5"></td>
            <td class="5_6"></td>
            <td class="5_7"></td>
            <td class="5_8"></td>
            <td class="5_9"></td>
            <td class="5_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">6</td>
            <td class="6_1"></td>
            <td class="6_2"></td>
            <td class="6_3"></td>
            <td class="6_4"></td>
            <td class="6_5"></td>
            <td class="6_6"></td>
            <td class="6_7"></td>
            <td class="6_8"></td>
            <td class="6_9"></td>
            <td class="6_10"></td>

        </tr>
        <tr>
            <td class="notToSelect">7</td>
            <td class="7_1"></td>
            <td class="7_2"></td>
            <td class="7_3"></td>
            <td class="7_4"></td>
            <td class="7_5"></td>
            <td class="7_6"></td>
            <td class="7_7"></td>
            <td class="7_8"></td>
            <td class="7_9"></td>
            <td class="7_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">8</td>
            <td class="8_1"></td>
            <td class="8_2"></td>
            <td class="8_3"></td>
            <td class="8_4"></td>
            <td class="8_5"></td>
            <td class="8_6"></td>
            <td class="8_7"></td>
            <td class="8_8"></td>
            <td class="8_9"></td>
            <td class="8_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">9</td>
            <td class="9_1"></td>
            <td class="9_2"></td>
            <td class="9_3"></td>
            <td class="9_4"></td>
            <td class="9_5"></td>
            <td class="9_6"></td>
            <td class="9_7"></td>
            <td class="9_8"></td>
            <td class="9_9"></td>
            <td class="9_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">10</td>
            <td class="10_1"></td>
            <td class="10_2"></td>
            <td class="10_3"></td>
            <td class="10_4"></td>
            <td class="10_5"></td>
            <td class="10_6"></td>
            <td class="10_7"></td>
            <td class="10_8"></td>
            <td class="10_9"></td>
            <td class="10_10"></td>
        </tr>

    </table>
</div>

<div id="playerTwo">
    <table class="PlayerField">
        <tr>
            <td class="notToSelect"></td>
            <td class="notToSelect">1</td>
            <td class="notToSelect">2</td>
            <td class="notToSelect">3</td>
            <td class="notToSelect">4</td>
            <td class="notToSelect">5</td>
            <td class="notToSelect">6</td>
            <td class="notToSelect">7</td>
            <td class="notToSelect">8</td>
            <td class="notToSelect">9</td>
            <td class="notToSelect">10</td>
        </tr>
        <tr>
            <td class="notToSelect">1</td>
            <td class="1_1"></td>
            <td class="1_2"></td>
            <td class="1_3"></td>
            <td class="1_4"></td>
            <td class="1_5"></td>
            <td class="1_6"></td>
            <td class="1_7"></td>
            <td class="1_8"></td>
            <td class="1_9"></td>
            <td class="1_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">2</td>
            <td class="2_1"></td>
            <td class="2_2"></td>
            <td class="2_3"></td>
            <td class="2_4"></td>
            <td class="2_5"></td>
            <td class="2_6"></td>
            <td class="2_7"></td>
            <td class="2_8"></td>
            <td class="2_9"></td>
            <td class="2_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">3</td>
            <td class="3_1"></td>
            <td class="3_2"></td>
            <td class="3_3"></td>
            <td class="3_4"></td>
            <td class="3_5"></td>
            <td class="3_6"></td>
            <td class="3_7"></td>
            <td class="3_8"></td>
            <td class="3_9"></td>
            <td class="3_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">4</td>
            <td class="4_1"></td>
            <td class="4_2"></td>
            <td class="4_3"></td>
            <td class="4_4"></td>
            <td class="4_5"></td>
            <td class="4_6"></td>
            <td class="4_7"></td>
            <td class="4_8"></td>
            <td class="4_9"></td>
            <td class="4_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">5</td>
            <td class="5_1"></td>
            <td class="5_2"></td>
            <td class="5_3"></td>
            <td class="5_4"></td>
            <td class="5_5"></td>
            <td class="5_6"></td>
            <td class="5_7"></td>
            <td class="5_8"></td>
            <td class="5_9"></td>
            <td class="5_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">6</td>
            <td class="6_1"></td>
            <td class="6_2"></td>
            <td class="6_3"></td>
            <td class="6_4"></td>
            <td class="6_5"></td>
            <td class="6_6"></td>
            <td class="6_7"></td>
            <td class="6_8"></td>
            <td class="6_9"></td>
            <td class="6_10"></td>

        </tr>
        <tr>
            <td class="notToSelect">7</td>
            <td class="7_1"></td>
            <td class="7_2"></td>
            <td class="7_3"></td>
            <td class="7_4"></td>
            <td class="7_5"></td>
            <td class="7_6"></td>
            <td class="7_7"></td>
            <td class="7_8"></td>
            <td class="7_9"></td>
            <td class="7_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">8</td>
            <td class="8_1"></td>
            <td class="8_2"></td>
            <td class="8_3"></td>
            <td class="8_4"></td>
            <td class="8_5"></td>
            <td class="8_6"></td>
            <td class="8_7"></td>
            <td class="8_8"></td>
            <td class="8_9"></td>
            <td class="8_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">9</td>
            <td class="9_1"></td>
            <td class="9_2"></td>
            <td class="9_3"></td>
            <td class="9_4"></td>
            <td class="9_5"></td>
            <td class="9_6"></td>
            <td class="9_7"></td>
            <td class="9_8"></td>
            <td class="9_9"></td>
            <td class="9_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">10</td>
            <td class="10_1"></td>
            <td class="10_2"></td>
            <td class="10_3"></td>
            <td class="10_4"></td>
            <td class="10_5"></td>
            <td class="10_6"></td>
            <td class="10_7"></td>
            <td class="10_8"></td>
            <td class="10_9"></td>
            <td class="10_10"></td>
        </tr>

    </table>
</div>

<div id="logForSeaBattle">

</div>

<div id="button">
    <p><input type="button" value=" Разместить случайно "></p>
</div>


<script type="text/javascript">
window.onload = function () {
    var $button = $("#button");
    // seaBattle.addClass(["1_1", "2_1", "3_1", "4_1"], 4, $("#playerTwo"),[1, false]  , "#playerOne");
    $button.on('click', function () {
        $button.css("display", "none");
        seaBattle.placementOfShips();


        var $table = $("#playerTwo").find('table td').not('.notToSelect').not('.deadZone');
        $table.on('click', function () {

            var numbXY = $(this).attr("class").split(' ', 1);


            if (seaBattle.arrShips("life", numbXY[0], "#playerTwo")) {
                $(this).addClass('fire');

                seaBattle.verificationAfterFire(this, 2);
                seaBattle.checkFinal(true);
            } else {
                $(this).addClass('miss');
                // seaBattle.checkFinal(false);
                seaBattle.afterMiss(this);

                function fun() {
                    seaBattle.randomFire();
                    seaBattle.checkFinal(false);
                }

                setTimeout(fun, 100);
            }


        });
    });
};
/*var $tableOne = $("#playerOne").find('table td').not('.notToSelect').not('.deadZone');

 var aaa = function (){
 var $tableOne = null;
 return $tableOne = $("#playerOne").find('table td').not('.notToSelect').not('.deadZone');
 };

 $(".shipsRemove").on('click', function () {
 $(function() {
 $( ".shipsRemove" ).draggable({ revert: "invalid" });
 $("#playerOne").find('table td').not('.notToSelect').not('.deadZone').droppable({
 activeClass: "ui-state-default",
 hoverClass: "ui-state-hover",
 drop: function( event, ui ) {
 $( this )
 .addClass( "one" );
 var coordinates = $(this).attr("class").split(' ', 1);
 seaBattle.ships[9].life.push(coordinates.toString());
 console.log("9 - " + seaBattle.ships[9].life);
 seaBattle.deadZone(9, 1, "#playerOne");

 ui.draggable.remove();

 }
 });
 });

 });
 $(".shipsRemove8").on('click', function () {
 $(function() {
 $( ".shipsRemove8" ).draggable({ revert: "invalid" });
 aaa().droppable({
 activeClass: "ui-state-default",
 hoverClass: "ui-state-hover",
 drop: function( event, ui ) {
 $( this )
 .addClass( "one" );
 var coordinates = $(this).attr("class").split(' ', 1);
 seaBattle.ships[8].life.push(coordinates.toString());
 console.log("9 - " + seaBattle.ships[8].life);
 seaBattle.deadZone(8, 1, "#playerOne");
 ui.draggable.remove();

 }
 });
 });

 });*/

/*   $('body').keyup(function(){
 if(event.keyCode==16)
 {
 console.log(event.keyCode);

 return false;
 }
 });
 */
/*   $(".shipsRemove_9").keyup(function (e) {
 if ((e.which == 16)) {
 console.log(e.which);
 ///$tableOne.removeClass("locationsRed");
 // side = !side;
 // seaBattle.locationShips($(this).attr("class").split(' ', 1), true, side);
 return false;
 }

 });
 */
var directionXY = true; //направление корабля в ручной растановке по умолчанию вверх

document.onkeydown = function (e) {
    e = e || window.event;

    if ((e.keyCode == 82)) {
        console.log(e.keyCode);
        directionXY = false;
    }

};


( function () {
    $("#playerOne").find('table td').not('.notToSelect').attr('droppable', 'droppable');
}());
dragManager.onDragCancel = function (dragObject) {

    /*    $("#playerOne").keyup(function (e) {
     if ((e.which == 16)) {
     console.log(e.which);
     ///$tableOne.removeClass("locationsRed");
     // side = !side;
     // seaBattle.locationShips($(this).attr("class").split(' ', 1), true, side);
     return false;
     }

     });
     */
    dragObject.avatar.rollback();
};

dragManager.onDragEnd = function (dragObject, dropElem) {
    console.log(dragObject);

    if ($(dropElem).hasClass("deadZone")) {
        return dragObject.avatar.rollback();
    }


    var $dragObject = $(dragObject.elem).attr('class');
    console.log($dragObject);

    seaBattle.locationShips(dragObject, dropElem, $dragObject);


};


/* $(function() {
 $( ".shipsRemove8" ).draggable({ revert: "invalid" });
 aaa().droppable({
 activeClass: "ui-state-default",
 hoverClass: "ui-state-hover",
 drop: function( event, ui ) {
 $( this )
 .addClass( "one" );
 var coordinates = $(this).attr("class").split(' ', 1);
 seaBattle.ships[8].life.push(coordinates.toString());
 console.log("8 - " + seaBattle.ships[8].life);
 seaBattle.deadZone(8, 1, "#playerOne");
 ui.draggable.remove();
 }
 });
 });*/

/*   $(".one").draggable({ revert: "invalid" });
 $tableOne.droppable();*/


/* var side = false;                                                            //в какой плоскости корабль
 $tableOne.mouseenter(function(){
 seaBattle.locationShips($(this).attr("class").split(' ', 1), true, side);
 });
 $tableOne.mousedown(function (e) {
 if ((e.which == 3)) {
 console.log(e.which);
 $tableOne.removeClass("locationsRed");
 side = !side;
 seaBattle.locationShips($(this).attr("class").split(' ', 1), true, side);
 return false;
 }

 });
 $tableOne.mouseleave(function(){
 seaBattle.locationShips($(this).attr("class").split(' ', 1), false, side);

 });*/


// $tableOne.keypress(function(){
///    seaBattle.locationShips($(this).attr("class").split(' ', 1), false);

// });


</script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">

    <script type="application/javascript" src="seaBattle.js"></script>
    <script src="jquery.js" type="text/javascript"></script>
    <script type="text/javascript" src="lib.js"></script>
    <script type="text/javascript" src="Drag.js"></script>

    <link rel="stylesheet" type="text/css" href="css.css">
    <title></title>
</head>
<body>

<header>
    <h1> Морской бой </h1>

    <p>пре-альфа</p>

    <p><a href="https://github.com/Vit220/test">ссылка на github</a></p>
</header>



<div id="playerOne" oncontextmenu="return false;">
    <table class="PlayerField">
        <tr>
            <td class="notToSelect"></td>
            <td class="notToSelect">1</td>
            <td class="notToSelect">2</td>
            <td class="notToSelect">3</td>
            <td class="notToSelect">4</td>
            <td class="notToSelect">5</td>
            <td class="notToSelect">6</td>
            <td class="notToSelect">7</td>
            <td class="notToSelect">8</td>
            <td class="notToSelect">9</td>
            <td class="notToSelect">10</td>
        </tr>
        <tr>
            <td class="notToSelect">А</td>
            <td class="1_1"></td>
            <td class="1_2"></td>
            <td class="1_3"></td>
            <td class="1_4"></td>
            <td class="1_5"></td>
            <td class="1_6"></td>
            <td class="1_7"></td>
            <td class="1_8"></td>
            <td class="1_9"></td>
            <td class="1_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">Б</td>
            <td class="2_1"></td>
            <td class="2_2"></td>
            <td class="2_3"></td>
            <td class="2_4"></td>
            <td class="2_5"></td>
            <td class="2_6"></td>
            <td class="2_7"></td>
            <td class="2_8"></td>
            <td class="2_9"></td>
            <td class="2_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">В</td>
            <td class="3_1"></td>
            <td class="3_2"></td>
            <td class="3_3"></td>
            <td class="3_4"></td>
            <td class="3_5"></td>
            <td class="3_6"></td>
            <td class="3_7"></td>
            <td class="3_8"></td>
            <td class="3_9"></td>
            <td class="3_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">Г</td>
            <td class="4_1"></td>
            <td class="4_2"></td>
            <td class="4_3"></td>
            <td class="4_4"></td>
            <td class="4_5"></td>
            <td class="4_6"></td>
            <td class="4_7"></td>
            <td class="4_8"></td>
            <td class="4_9"></td>
            <td class="4_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">Д</td>
            <td class="5_1"></td>
            <td class="5_2"></td>
            <td class="5_3"></td>
            <td class="5_4"></td>
            <td class="5_5"></td>
            <td class="5_6"></td>
            <td class="5_7"></td>
            <td class="5_8"></td>
            <td class="5_9"></td>
            <td class="5_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">Е</td>
            <td class="6_1"></td>
            <td class="6_2"></td>
            <td class="6_3"></td>
            <td class="6_4"></td>
            <td class="6_5"></td>
            <td class="6_6"></td>
            <td class="6_7"></td>
            <td class="6_8"></td>
            <td class="6_9"></td>
            <td class="6_10"></td>

        </tr>
        <tr>
            <td class="notToSelect">Ж</td>
            <td class="7_1"></td>
            <td class="7_2"></td>
            <td class="7_3"></td>
            <td class="7_4"></td>
            <td class="7_5"></td>
            <td class="7_6"></td>
            <td class="7_7"></td>
            <td class="7_8"></td>
            <td class="7_9"></td>
            <td class="7_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">З</td>
            <td class="8_1"></td>
            <td class="8_2"></td>
            <td class="8_3"></td>
            <td class="8_4"></td>
            <td class="8_5"></td>
            <td class="8_6"></td>
            <td class="8_7"></td>
            <td class="8_8"></td>
            <td class="8_9"></td>
            <td class="8_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">И</td>
            <td class="9_1"></td>
            <td class="9_2"></td>
            <td class="9_3"></td>
            <td class="9_4"></td>
            <td class="9_5"></td>
            <td class="9_6"></td>
            <td class="9_7"></td>
            <td class="9_8"></td>
            <td class="9_9"></td>
            <td class="9_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">К</td>
            <td class="10_1"></td>
            <td class="10_2"></td>
            <td class="10_3"></td>
            <td class="10_4"></td>
            <td class="10_5"></td>
            <td class="10_6"></td>
            <td class="10_7"></td>
            <td class="10_8"></td>
            <td class="10_9"></td>
            <td class="10_10"></td>
        </tr>

    </table>
</div>

<div id="playerTwo" oncontextmenu="return false;">
    <table class="PlayerField">
        <tr>
            <td class="notToSelect"></td>
            <td class="notToSelect">1</td>
            <td class="notToSelect">2</td>
            <td class="notToSelect">3</td>
            <td class="notToSelect">4</td>
            <td class="notToSelect">5</td>
            <td class="notToSelect">6</td>
            <td class="notToSelect">7</td>
            <td class="notToSelect">8</td>
            <td class="notToSelect">9</td>
            <td class="notToSelect">10</td>
        </tr>
        <tr>
            <td class="notToSelect">А</td>
            <td class="1_1"></td>
            <td class="1_2"></td>
            <td class="1_3"></td>
            <td class="1_4"></td>
            <td class="1_5"></td>
            <td class="1_6"></td>
            <td class="1_7"></td>
            <td class="1_8"></td>
            <td class="1_9"></td>
            <td class="1_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">Б</td>
            <td class="2_1"></td>
            <td class="2_2"></td>
            <td class="2_3"></td>
            <td class="2_4"></td>
            <td class="2_5"></td>
            <td class="2_6"></td>
            <td class="2_7"></td>
            <td class="2_8"></td>
            <td class="2_9"></td>
            <td class="2_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">В</td>
            <td class="3_1"></td>
            <td class="3_2"></td>
            <td class="3_3"></td>
            <td class="3_4"></td>
            <td class="3_5"></td>
            <td class="3_6"></td>
            <td class="3_7"></td>
            <td class="3_8"></td>
            <td class="3_9"></td>
            <td class="3_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">Г</td>
            <td class="4_1"></td>
            <td class="4_2"></td>
            <td class="4_3"></td>
            <td class="4_4"></td>
            <td class="4_5"></td>
            <td class="4_6"></td>
            <td class="4_7"></td>
            <td class="4_8"></td>
            <td class="4_9"></td>
            <td class="4_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">Д</td>
            <td class="5_1"></td>
            <td class="5_2"></td>
            <td class="5_3"></td>
            <td class="5_4"></td>
            <td class="5_5"></td>
            <td class="5_6"></td>
            <td class="5_7"></td>
            <td class="5_8"></td>
            <td class="5_9"></td>
            <td class="5_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">Е</td>
            <td class="6_1"></td>
            <td class="6_2"></td>
            <td class="6_3"></td>
            <td class="6_4"></td>
            <td class="6_5"></td>
            <td class="6_6"></td>
            <td class="6_7"></td>
            <td class="6_8"></td>
            <td class="6_9"></td>
            <td class="6_10"></td>

        </tr>
        <tr>
            <td class="notToSelect">Ж</td>
            <td class="7_1"></td>
            <td class="7_2"></td>
            <td class="7_3"></td>
            <td class="7_4"></td>
            <td class="7_5"></td>
            <td class="7_6"></td>
            <td class="7_7"></td>
            <td class="7_8"></td>
            <td class="7_9"></td>
            <td class="7_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">З</td>
            <td class="8_1"></td>
            <td class="8_2"></td>
            <td class="8_3"></td>
            <td class="8_4"></td>
            <td class="8_5"></td>
            <td class="8_6"></td>
            <td class="8_7"></td>
            <td class="8_8"></td>
            <td class="8_9"></td>
            <td class="8_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">И</td>
            <td class="9_1"></td>
            <td class="9_2"></td>
            <td class="9_3"></td>
            <td class="9_4"></td>
            <td class="9_5"></td>
            <td class="9_6"></td>
            <td class="9_7"></td>
            <td class="9_8"></td>
            <td class="9_9"></td>
            <td class="9_10"></td>
        </tr>
        <tr>
            <td class="notToSelect">К</td>
            <td class="10_1"></td>
            <td class="10_2"></td>
            <td class="10_3"></td>
            <td class="10_4"></td>
            <td class="10_5"></td>
            <td class="10_6"></td>
            <td class="10_7"></td>
            <td class="10_8"></td>
            <td class="10_9"></td>
            <td class="10_10"></td>
        </tr>

    </table>
</div>



<div class="buttonSeaBattle">
<span>
    <input id="buttonRandom" type="button" value=" Разместить случайно ">
</span>
<span>
    <input id="buttonStartGame" type="button" value="Начать игру!">
</span>
<span>
    <input id="restartGame" type="button" value="Заново!">
</span>
</div>

<div class="shipsDiv">
    <div class="shipsRemove_9" draggable oncontextmenu="return false;">
    </div>
    <div class="shipsRemove_8" draggable oncontextmenu="return false;">
    </div>
    <div class="shipsRemove_7" draggable oncontextmenu="return false;">
    </div>
    <div class="shipsRemove_6" draggable oncontextmenu="return false;">
    </div>
    <div class="shipsRemove_5" draggable oncontextmenu="return false;">
    </div>
    <div class="shipsRemove_4" draggable oncontextmenu="return false;">
    </div>
    <div class="shipsRemove_3" draggable oncontextmenu="return false;">
    </div>
    <div class="shipsRemove_2" draggable oncontextmenu="return false;">
    </div>
    <div class="shipsRemove_1" draggable oncontextmenu="return false;">
    </div>
    <div class="shipsRemove_0" draggable oncontextmenu="return false;">
    </div>
</div>

<div id="logForSeaBattle">

</div>


<script type="text/javascript">
window.onload = function () {
    var $buttonRandom = $("#buttonRandom"),
            $buttonStartGame = $("#buttonStartGame"),
            $shipsDiv = $(".shipsDiv"),
            $restartGame = $("#restartGame"),
            $table = $("#playerTwo").find('table td').not('.notToSelect').not('.deadZone');



    ( function () {
        $("#playerOne").find('table td').not('.notToSelect').attr('droppable', 'droppable');
    }());

    //var documentFragment = document.createDocumentFragment();
    var aaa = $("#playerOne").find(".PlayerField");
    //documentFragment.appendChild(aaa);


    dragManager.onDragCancel = function (dragObject) {
        //console.log(dragObject);
        dragObject.avatar.rollback();
    };

    dragManager.onDragEnd = function (dragObject, dropElem) {
        if ($(dropElem).hasClass("deadZone") || $(dropElem).hasClass("ship")) {
            return;
        }
        var $dragObject = $(dragObject.elem).attr('class');
        console.log($dragObject);
        seaBattle.locationShips(dragObject, dropElem, $dragObject);
    };


    $buttonStartGame.on('click', function () {
        $buttonStartGame.css("display", "none");
        $shipsDiv.css("display", "none");
        $restartGame.css("display", "block");
        seaBattle.placementOfShips(false);
        letsGoSeaBattle();
    });
    $restartGame.on('click', function () {
        location.reload();
    });
    $buttonRandom.on('click', function () {
       //seaBattle.restartGame(aaa);
        $buttonRandom.css("display", "none");
        $buttonStartGame.css("display", "block");
        $restartGame.css("display", "block");
        seaBattle.placementOfShips(true);
        $shipsDiv.css("display", "none");
    });


    var letsGoSeaBattle = function () {
        $table.on('click', function () {


            var numbXY = $(this).attr("class").split(' ', 1);


            if (seaBattle.arrShips("life", numbXY[0], "#playerTwo")) {
             /*   seaBattle.checkFinal(true);
                seaBattle.checkFinal(false);*/
                $(this).addClass('fire');

                seaBattle.verificationAfterFire(this, 2);

            } else {
               // seaBattle.checkFinal(false);
                $(this).addClass('miss');
                // seaBattle.checkFinal(false);
                seaBattle.afterMiss(this);

                function fun() {
                    seaBattle.randomFire();


                }

                setTimeout(fun, 300);
            }


        });
    };


};
//var $table = $("#playerTwo").find('table td').not('.notToSelect').not('.deadZone');

/*var $tableOne = $("#playerOne").find('table td').not('.notToSelect').not('.deadZone');

 var aaa = function (){
 var $tableOne = null;
 return $tableOne = $("#playerOne").find('table td').not('.notToSelect').not('.deadZone');
 };

 $(".shipsRemove").on('click', function () {
 $(function() {
 $( ".shipsRemove" ).draggable({ revert: "invalid" });
 $("#playerOne").find('table td').not('.notToSelect').not('.deadZone').droppable({
 activeClass: "ui-state-default",
 hoverClass: "ui-state-hover",
 drop: function( event, ui ) {
 $( this )
 .addClass( "one" );
 var coordinates = $(this).attr("class").split(' ', 1);
 seaBattle.ships[9].life.push(coordinates.toString());
 console.log("9 - " + seaBattle.ships[9].life);
 seaBattle.deadZone(9, 1, "#playerOne");

 ui.draggable.remove();

 }
 });
 });

 });
 $(".shipsRemove8").on('click', function () {
 $(function() {
 $( ".shipsRemove8" ).draggable({ revert: "invalid" });
 aaa().droppable({
 activeClass: "ui-state-default",
 hoverClass: "ui-state-hover",
 drop: function( event, ui ) {
 $( this )
 .addClass( "one" );
 var coordinates = $(this).attr("class").split(' ', 1);
 seaBattle.ships[8].life.push(coordinates.toString());
 console.log("9 - " + seaBattle.ships[8].life);
 seaBattle.deadZone(8, 1, "#playerOne");
 ui.draggable.remove();

 }
 });
 });

 });*/

/*   $('body').keyup(function(){
 if(event.keyCode==16)
 {
 console.log(event.keyCode);

 return false;
 }
 });
 */
/*   $(".shipsRemove_9").keyup(function (e) {
 if ((e.which == 16)) {
 console.log(e.which);
 ///$tableOne.removeClass("locationsRed");
 // side = !side;
 // seaBattle.locationShips($(this).attr("class").split(' ', 1), true, side);
 return false;
 }

 });
 */
//var directionXY = true; //направление корабля в ручной растановке по умолчанию вверх




/* $(function() {
 $( ".shipsRemove8" ).draggable({ revert: "invalid" });
 aaa().droppable({
 activeClass: "ui-state-default",
 hoverClass: "ui-state-hover",
 drop: function( event, ui ) {
 $( this )
 .addClass( "one" );
 var coordinates = $(this).attr("class").split(' ', 1);
 seaBattle.ships[8].life.push(coordinates.toString());
 console.log("8 - " + seaBattle.ships[8].life);
 seaBattle.deadZone(8, 1, "#playerOne");
 ui.draggable.remove();
 }
 });
 });*/

/*   $(".one").draggable({ revert: "invalid" });
 $tableOne.droppable();*/


/* var side = false;                                                            //в какой плоскости корабль
 $tableOne.mouseenter(function(){
 seaBattle.locationShips($(this).attr("class").split(' ', 1), true, side);
 });
 $tableOne.mousedown(function (e) {
 if ((e.which == 3)) {
 console.log(e.which);
 $tableOne.removeClass("locationsRed");
 side = !side;
 seaBattle.locationShips($(this).attr("class").split(' ', 1), true, side);
 return false;
 }

 });
 $tableOne.mouseleave(function(){
 seaBattle.locationShips($(this).attr("class").split(' ', 1), false, side);

 });*/


// $tableOne.keypress(function(){
///    seaBattle.locationShips($(this).attr("class").split(' ', 1), false);

// });


</script>

</body>
</html>
